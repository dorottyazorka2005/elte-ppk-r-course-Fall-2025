---
title: "Assignment 1: The cocktail bar (data transformation and manipulation)"
author: "Dorottya Csala"
output: html_document
editor_options: 
  chunk_output_type: console
---

# Skills needed to solve this assignment

-   Using R and RStudio, reading data
-   Reporting using RMarkdown
-   Using Git and Github (for submitting the task)
-   Data manipulation (e.g. dplyr, tidyr)
-   String manipulation (e.g. stringr)

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

# Background

Your Cuban uncle sets up a cocktail bar in downtown Budapest. He has a secret list of cocktails that he would like to serve in the bar. He asks you to do create a few lists and tables to set up the shop. As your uncle is a secret hipster, he has a dataset on Github that you can use for the task!

![](https://media1.tenor.com/images/57a519cffd0ad4693be3b9c94b211540/tenor.gif?itemid=5195211){width="320"}

Note: There are several different ways to solve these tasks, feel free to come up with your own.

## 1. Read the data

Read the cocktail dataset from: <https://github.com/nthun/cocktail-balance> You can also find the codebook there.

```{r}
cocktail <- read_tsv("cocktail_data.tsv")
print(cocktail)
```

## 2. Transform the data table and clean the ingredient variable!

The ingredients are currently in a single cell for each cocktail. It would be better to put them in separate rows. Also, the variable should be cleaned of all quantities (e.g. 1/2 oz, 2 dashes, etc.), and the indicator of alcohol content (e.g. 47.3% abv). You will need to use this cleaned table in later tasks.

```{r}
cleaned_table <- cocktail %>%
  separate_rows(ingredients, sep= "<[^>]+>") %>%
  mutate(ingredients = str_trim(ingredients)) %>%
  mutate(ingredients = str_remove_all(ingredients, "\\(?\\s*\\d+\\.?\\d*%\\s*[Aa][Bb][Vv]\\s*\\)?")) %>%
  mutate(ingredients = str_remove_all(
    ingredients,
    "\\b(\\d+\\s*/\\s*\\d+|\\d+\\.?\\d*|half|quarter|a|one|two|three|four|five)\\s*(oz|ounce|ounces|ml|cl|cup|cups|tsp|tbsp|dash(?:es)?|drop(?:s)?|cube(?:s)?|slice(?:s)?|twist|part(?:s)?|barspoon(?:s)?|measure(?:s)?)\\b"
  )) %>%
  mutate(ingredients = str_remove_all(ingredients, "[()\\d]")) %>%
  mutate(ingredients = str_squish(ingredients)) %>%
  filter(ingredients != "")

print(cleaned_table)
  
```

## 3. All ingredients in alphabetical order

Before opening the bar, you need to find a reliable supplier that has all the ingredients. You need to send a list of all possible ingredients you will need. They don't need the quantities (i.e. how many of these are needed), just the names of the ingredients.

```{r}
ingredients_alphabetical <- cleaned_table %>%
  select(ingredients) %>%
  distinct() %>%
  arrange(ingredients) 
  
print(ingredients_alphabetical)


```

## 4. Number of unique ingredients

How many different ingredients you will need?

```{r}
unique_ingredients <- length(unique(ingredients_alphabetical$ingredients))

print(unique_ingredients)

# There are 63 unique ingredients
  
```

## 5. What are the top 10 ingredients?

What are the 10 most frequently used ingredients? If there are ties, you can list more than 10.

```{r}
frequent_ingredients <- cleaned_table %>%
  count(ingredients, sort = TRUE) %>%  
  slice_max(n, n = 10, with_ties = TRUE)  

print(frequent_ingredients)

# The top 10 ingridients used in cocktails: lemon juice (15), simple syrup (14), gin and sweet vermouth (13), lime juice and Angostura bitters (12), saline solution and water (10), rye (8), Cognac and Luxardo Maraschino (6)
```

## 6. Which cocktail(s) has/have the most ingredients?

Count the number of ingredients and filter all the cocktails that has that many.

```{r}
cocktails_count <- cleaned_table %>%
  group_by(name) %>%
  summarise(num_ingredients= n())

print(cocktails_count)

most_ingredients <- cocktails_count %>%
  filter(num_ingredients == max(num_ingredients))

print(most_ingredients)

# The following cocktails have the most ingredients: Vieux Carre, Pink Lady, De La Louisiane, Clover Club, Carbonated Negroni, Blender Margarita. All of these cocktails have 6 ingridients
  
```

## 7. How many ingredients appear in only one cocktail (rare ingredient)?

Count all cocktails with only one ingredient, and

```{r}
rare_ingredients <- cleaned_table %>%
  group_by(ingredients) %>%
  summarise(num_cocktails= n_distinct(name)) %>%
  filter(num_cocktails == 1) %>%
  pull(ingredients)


num_rare_ingredients <- length(rare_ingredients)

print(num_rare_ingredients)

rare_name <- rare_ingredients

print(rare_name)

# 30 ingredients appear in only one cocktail
```

## 8. Which cocktail has an ingredient that is only used in one cocktail?

```{r}
one_cocktail <- cleaned_table %>%
  group_by(ingredients) %>%
  mutate(num_cocktails = n_distinct(name)) %>%
  ungroup() %>%
  filter(num_cocktails == 1) %>%
  select(name) %>%
  distinct() 

print(one_cocktail)

# There are 23 cocktails that have an ingridient that is used only in one cocktail: Pisco Sour, Pink Lady, Clover Club, Blood and Sand, Alexander, Cosmopolitan (Modern/Bastardized), 20th Century Cocktail, Aviation, Last Word, Blinker, Blackthorn, Hanky Panky, Martinez, Brooklyn, Rusty Nail, De La Louisiane, Blender Daiquiri, Blender Margarita, Blender Whiskey Sour, Gin and Tonic (Dry), Carbonated Negroni, Gin and Juice Centrifuge, Gin and Juice Agar

  
```

## 9. What are the cocktails without rare ingredients?

```{r}
common_cocktails <- cleaned_table %>%
  group_by(name) %>%
  summarise(has_rare = any(ingredients %in% rare_ingredients)) %>%  
  filter(!has_rare) %>%                                          
  select(name)

print(common_cocktails)

# There are 32 cocktails without rare ingridients: Bee's Knees, Between the Sheets, Bijou, Bobby Burns, Brady Crusta, Brown Derby, Carbonated Margarita, Carbonated Whiskey Sour, Champs-Elysses, Chartruth, Classic Daiquiri, Corpse Reviver #2, Daiquiri with More Lime, Fresh Lime Gimlet, Gold Rush, Hemingway Daiquiri, Honeysuckle, Improved Whiskey Cocktail, Jack Rose, Manhatan (Boubon, 45% abv), Manhatan (Rye, 50% abv), Margarita, Negroni, Old Fashioned, Old Pal, Pegu Club, Rob Roy, Sidecar, Southside, Vieux Carre, Whiskey Sour, Widow's Kiss
  
```

## 10. Create a cheat sheet for the bartender!

Create a matrix that shows all cocktail names as rows and all ingredients as columns. When a cocktail requires an ingredient, there should be an "X" in the cell, otherwise, the cell should remain empty. Example:

```{r echo=FALSE}
tribble(~name, ~Lime, ~`White rum`, ~`Cane sugar`, ~`Coca-cola`, ~Mint, ~Soda,
        "Caipirissima", "X", "X", "X", "", "", "",
        "Cuba Libre", "X", "X", "", "X","","",
        "Mojito", "X", "X", "", "", "X", "X") %>% 
    relocate(name, sort(names(.)))
```

```{r}
cheat_sheet <- cleaned_table %>%
  distinct(name, ingredients) %>%                  
  mutate(
    name = str_trim(name),
    ingredients = str_trim(str_to_title(ingredients)),  
    present = "X"
  ) %>%
  pivot_wider(
    names_from = ingredients,
    values_from = present,
    values_fill = ""                                  
  ) %>%
  relocate(name, sort(names(.)[-1]))

print(cheat_sheet)
```


Congrats, the bar is now officially open!

![](https://i.pinimg.com/originals/4e/c1/0c/4ec10c9d32b2c7c28b4b638c7f809ec5.gif){width="320"}
